<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Moon Web — Minimal Workspace Demo</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		:root {
			--bg: #0c0d10;
			--panel: #111319;
			--muted: #7a808c;
			--text: #e5e7eb;
			--accent: #8de1ff;
			--border: #1a1d24;
		}
		* { box-sizing: border-box; }
		body {
			margin: 0;
			padding: 12px;
			background: var(--bg);
			color: var(--text);
			font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
			line-height: 1.45;
			font-size: 12px;
		}
		.layout {
			max-width: 880px;
			margin: 0 auto;
			display: grid;
			gap: 6px;
			align-items: start;
		}
		.panel {
			background: var(--panel);
			border: 1px solid var(--border);
			border-radius: 3px;
			padding: 8px;
		}
		.header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 6px;
			flex-wrap: wrap;
		}
		.tabs {
			display: inline-flex;
			gap: 3px;
			flex-wrap: wrap;
		}
		.tab {
			border: 1px solid var(--border);
			background: transparent;
			color: var(--text);
			padding: 3px 6px;
			border-radius: 3px;
			cursor: pointer;
			transition: border-color 120ms ease, color 120ms ease, background-color 120ms ease;
		}
		.tab.active {
			border-color: var(--accent);
			color: var(--accent);
			background: rgba(141, 225, 255, 0.08);
		}
		.filters {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
			gap: 5px;
		}
		input, select, button {
			font-family: inherit;
			font-size: 12px;
			background: #0d0f14;
			color: var(--text);
			border: 1px solid var(--border);
			border-radius: 3px;
			padding: 5px 6px;
		}
		input:focus, select:focus, button:focus {
			outline: 1px solid var(--accent);
			outline-offset: 1px;
		}
		.list {
			display: grid;
			gap: 5px;
		}
		.card {
			border: 1px solid var(--border);
			border-radius: 3px;
			padding: 7px;
			background: #0f1116;
			transition: border-color 120ms ease;
		}
		.card:hover {
			border-color: var(--accent);
		}
		.card-head {
			display: flex;
			justify-content: space-between;
			gap: 6px;
			flex-wrap: wrap;
			align-items: center;
		}
		.meta {
			display: flex;
			gap: 5px;
			align-items: center;
			color: var(--muted);
			font-size: 11px;
		}
		.tag {
			display: inline-flex;
			align-items: center;
			gap: 4px;
			padding: 2px 5px;
			border-radius: 3px;
			background: #0c0d10;
			color: var(--accent);
			font-size: 11px;
			border: 1px solid var(--border);
		}
		.badge {
			padding: 2px 6px;
			border-radius: 3px;
			font-size: 11px;
			border: 1px solid var(--border);
			color: var(--muted);
		}
		form.new-item {
			display: grid;
			grid-template-columns: minmax(170px, 2fr) minmax(140px, 1.5fr) minmax(130px, 1.2fr) minmax(120px, 1.1fr) auto;
			gap: 5px;
			align-items: center;
		}
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border: 0;
		}
		@media (max-width: 720px) {
			form.new-item { grid-template-columns: 1fr; }
			.header { flex-direction: column; align-items: flex-start; }
		}
		.empty {
			text-align: center;
			color: var(--muted);
			padding: 14px;
			border: 1px dashed var(--border);
			border-radius: 3px;
		}
	</style>
</head>
<body>
	<div id="root" class="layout"></div>

	<!-- Point this src to your vendored copy of moon-web.min.js -->
	<script src="../packages/moon-web/dist/moon-web.min.js"></script>

	<script type="text/moon">
		Moon.view.mount(document.getElementById("root"));
		var cls = Moon.view.cls;

		var tabs = ["all", "todo", "doing", "review", "done"];
		var statusOptions = ["all", "todo", "doing", "review", "done"];
		var tagOptions = ["all", "design", "frontend", "backend", "docs", "ops", "api", "misc"];
		var sortOptions = [
			{ value: "recent", label: "Sort: Recent" },
			{ value: "priority", label: "Sort: Priority" },
			{ value: "alpha", label: "Sort: A → Z" }
		];
		var state = {
			tab: "all",
			q: "",
			sort: "recent",
			tag: "all",
			status: "all",
			items: [
				{ id: 1, title: "Landing layout", status: "todo", tags: ["design", "web"], priority: 3, updated: 1719955200000 },
				{ id: 2, title: "Docs IA pass", status: "doing", tags: ["docs"], priority: 2, updated: 1722550800000 },
				{ id: 3, title: "API mocks", status: "done", tags: ["api", "backend"], priority: 1, updated: 1724203200000 },
				{ id: 4, title: "Perf profiling", status: "todo", tags: ["ops"], priority: 2, updated: 1724894400000 },
				{ id: 5, title: "Component polish", status: "doing", tags: ["design", "frontend"], priority: 3, updated: 1725585600000 },
				{ id: 6, title: "Search relevance tweak", status: "review", tags: ["backend"], priority: 2, updated: 1726276800000 }
			],
			newTitle: "",
			newTag: "",
			newStatus: "todo",
			newPriority: 2
		};

		function updateItem(id, nextFields) {
			setState({
				items: state.items.map(function(item) {
					return item.id === id ? Object.assign({}, item, nextFields, { updated: now() }) : item;
				})
			});
		}

		function now() { return Date.now(); }

		function setState(next) {
			for (var key in next) {
				state[key] = next[key];
			}
			render();
		}

		function updateField(field, value) {
			setState({ [field]: value });
		}

		function updateFieldFromEvent(field) {
			return function(evt) { updateField(field, evt.target.value); };
		}

		function formatDate(ts) {
			return new Date(ts).toLocaleDateString();
		}

		function renderOptions(list, prefix) {
			return list.map(function(value) {
				return <option value={value} key={"opt-" + value}>{prefix ? prefix + value : value}</option>;
			});
		}

		function renderSelectOptions(objects) {
			return objects.map(function(item) {
				return <option value={item.value} key={"opt-" + item.value}>{item.label}</option>;
			});
		}

		function filteredItems() {
			var q = state.q.toLowerCase().trim();
			var tag = state.tag;
			var status = state.status === "all" ? null : state.status;
			var tab = state.tab === "all" ? null : state.tab;

			var list = state.items.filter(function(item) {
				var matchesTab = tab ? item.status === tab : true;
				var matchesStatus = status ? item.status === status : true;
				var matchesTag = tag === "all" ? true : item.tags.indexOf(tag) !== -1;
				var matchesQuery = q === "" ? true : (
					item.title.toLowerCase().indexOf(q) !== -1 ||
					item.tags.join(" ").toLowerCase().indexOf(q) !== -1
				);
				return matchesTab && matchesStatus && matchesTag && matchesQuery;
			});

			list.sort(function(a, b) {
				if (state.sort === "recent") return b.updated - a.updated;
				if (state.sort === "priority") return b.priority - a.priority;
				return a.title.localeCompare(b.title);
			});

			return list;
		}

		function toggleStatus(id) {
			const nextStatuses = { todo: "doing", doing: "review", review: "done", done: "todo" };
			const next = state.items.map(function(item) {
				return item.id === id ? Object.assign({}, item, { status: nextStatuses[item.status] || "todo", updated: now() }) : item;
			});
			setState({ items: next });
		}

		function bumpPriority(id, delta) {
			const next = state.items.map(function(item) {
				if (item.id === id) {
					var nextP = Math.min(3, Math.max(1, item.priority + delta));
					return Object.assign({}, item, { priority: nextP, updated: now() });
				}
				return item;
			});
			setState({ items: next });
		}

		function removeItem(id) {
			setState({ items: state.items.filter(function(item) { return item.id !== id; }) });
		}

		function renderItem(item) {
			var statusColors = { todo: "#e5e7eb", doing: "#8de1ff", review: "#facc15", done: "#34d399" };

			return (
				<div class="card" key={item.id}>
					<div class="card-head">
						<strong>{item.title}</strong>
						<div class="meta">
							<button class="badge" style={ { borderColor: statusColors[item.status] || "#1a1d24", color: statusColors[item.status] || "#e5e7eb", background: "transparent" } } onClick={() => toggleStatus(item.id)}>
								{item.status}
							</button>
							<div class="badge" style={ { display: "inline-flex", gap: "6px", alignItems: "center" } }>
								<button aria-label="Lower priority" style={ { background: "transparent", color: "var(--muted)", border: "none", cursor: "pointer" } } onClick={() => bumpPriority(item.id, -1)}>-</button>
								<span>P{item.priority}</span>
								<button aria-label="Raise priority" style={ { background: "transparent", color: "var(--muted)", border: "none", cursor: "pointer" } } onClick={() => bumpPriority(item.id, 1)}>+</button>
							</div>
							<span>{formatDate(item.updated)}</span>
							<button aria-label="Remove" style={ { background: "transparent", color: "var(--muted)", border: "none", cursor: "pointer" } } onClick={() => removeItem(item.id)}>×</button>
						</div>
					</div>
					<div style={ { marginTop: "6px", display: "flex", gap: "6px", flexWrap: "wrap" } }>
						{item.tags.map(function(tag) {
							return <span class="tag" key={item.id + "-" + tag}>#{tag}</span>;
						})}
					</div>
				</div>
			);
		}

		function addItem(evt) {
			evt.preventDefault();
			var title = state.newTitle.trim();
			if (title === "") return;

			var tags = state.newTag.trim() === "" ? [] : state.newTag.split(",").map(function(t) { return t.trim(); }).filter(Boolean);
			var next = {
				id: now(),
				title: title,
				status: state.newStatus,
				tags: tags.length ? tags : ["misc"],
				priority: Number(state.newPriority),
				updated: now()
			};

			setState({
				items: [next].concat(state.items),
				newTitle: "",
				newTag: "",
				newStatus: "todo",
				newPriority: 2
			});
		}

		function render() {
			var items = filteredItems();

			Moon.m.view = (
				<div class="layout">
					<div class="panel header">
						<div>
							<div style={ { fontWeight: "bold" } }>Workspace</div>
							<div style={ { color: "var(--muted)", fontSize: "12px" } }>Search, filter, and track work items</div>
						</div>
						<div class="tabs">
							{tabs.map(function(tab) {
								return (
									<button class={cls("tab", state.tab === tab && "active")} onClick={() => updateField("tab", tab)} key={"tab-" + tab}>
										{tab === "all" ? "All" : tab[0].toUpperCase() + tab.slice(1)}
									</button>
								);
							})}
						</div>
					</div>

					<div class="panel filters">
						<label class="sr-only" for="search">Search</label>
						<input id="search" type="search" placeholder="Search titles or tags" value={state.q} onInput={updateFieldFromEvent("q")} autofocus=true/>
						<select value={state.sort} onChange={updateFieldFromEvent("sort")}>{renderSelectOptions(sortOptions)}</select>
						<select value={state.status} onChange={updateFieldFromEvent("status")}>{renderOptions(statusOptions, "Status: ")}</select>
						<select value={state.tag} onChange={updateFieldFromEvent("tag")}>{renderOptions(tagOptions, "Tag: ")}</select>
					</div>

					<div class="panel">
						<form class="new-item" onSubmit={addItem}>
							<input type="text" placeholder="New item title" value={state.newTitle} onInput={updateFieldFromEvent("newTitle")} required=true/>
							<input type="text" placeholder="Tags (comma separated)" value={state.newTag} onInput={updateFieldFromEvent("newTag")}/>
							<select value={state.newStatus} onChange={updateFieldFromEvent("newStatus")}>
								<option value="todo">Status: Todo</option>
								<option value="doing">Status: Doing</option>
								<option value="review">Status: Review</option>
								<option value="done">Status: Done</option>
							</select>
							<select value={state.newPriority} onChange={updateFieldFromEvent("newPriority")}>
								<option value="1">Priority: 1 (low)</option>
								<option value="2">Priority: 2</option>
								<option value="3">Priority: 3 (high)</option>
							</select>
							<button type="submit" disabled={!state.newTitle.trim()} style={ { background: "var(--accent)", color: "#0b1222", fontWeight: "bold" } }>Add</button>
						</form>
					</div>

					<div class="panel">
						{items.length === 0 ?
							<div class="empty">No items match the current filters.</div> :
							<div class="list">{items.map(renderItem)}</div>
						}
					</div>
				</div>
			);
		}

		render();
	</script>
</body>
</html>
